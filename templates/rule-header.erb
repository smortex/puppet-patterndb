			<rule provider='<%= @provider -%>' id='<%= @id -%>'
<% if @context_id -%>
			      context-id='<%= @context_id -%>'
<% end -%>
<% if @context_scope -%>
			      context-scope='<%= @context_scope -%>'
<% end -%>
<% if @context_timeout -%>
			      context-timeout='<%= @context_timeout -%>'
<% end -%>
			      class='<%= @ruleclass -%>'>
				<patterns>
<% @patterns_a.each do |pattern| -%>
					<pattern><%= pattern -%></pattern>
<% end -%>
				</patterns>
<% if ! @values.empty? -%>
				<values>
<% Hash[@values].sort.each do |k,v| -%>
					<value name='<%= k %>'><%= scope.call_function('patterndb::htmlentities', v) %></value>
<% end -%>
				</values>
<% end -%>
<% if ! @tags.empty? -%>
				<tags>
<% @tags_a.each do |tag| -%>
					<tag><%= tag -%></tag>
<% end -%>
				</tags>
<% end -%>
<% if ! @examples.empty? -%>
				<examples>
<% @examples_a.each do |example| -%>
					<example>
						<test_message program="<%= example['program'] -%>"><%= scope.call_function('patterndb::htmlentities', example['test_message']) -%></test_message>
<% if example['test_values'] -%>
						<test_values>
<% Hash[example['test_values']].sort.each do |k,v| -%>
							<test_value name='<%=k%>'><%=scope.call_function('patterndb::htmlentities', v)%></test_value>
<% end -%>
						</test_values>
<% end -%>
					</example>
<% end -%>
				</examples>
<% end -%>
				<actions>
